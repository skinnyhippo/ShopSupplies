<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Supplies Order Form</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4 max-w-5xl mt-4 bg-white rounded-lg shadow-md relative">
        <div class="absolute top-4 right-4 text-sm text-gray-500">Last updated 06/23/25 08:46 PM EDT</div>
        <h1 class="text-3xl font-bold mb-4 text-center text-gray-800">Shop Supplies Order Form</h1>
        <p class="mb-4 text-gray-600 text-center">Enter the quantity needed for each item.</p>
        <form id="orderForm" class="space-y-1">
            <div class="bg-gray-100 p-1 flex items-center space-x-4 border-b border-gray-300">
                <div class="w-72 text-right font-semibold text-sm text-gray-700">Item</div>
                <div class="w-32 text-left font-semibold text-sm text-gray-700">Quantity Requested</div>
                <div class="w-40 text-left font-semibold text-sm text-gray-700">Unit Note</div>
            </div>
            <div id="itemList" class="space-y-1">
                <!-- Rows will be added by JavaScript -->
            </div>
            <div class="mt-4">
                <label for="notes" class="block mb-2 text-gray-700 font-medium">Other Notes or Additional Items:</label>
                <textarea id="notes" class="w-full p-3 border rounded focus:ring-2 focus:ring-blue-300" rows="5" placeholder="Enter additional items or notes here..."></textarea>
            </div>
            <div class="mt-4 flex items-center justify-center space-x-4">
                <div>
                    <label for="orderBy" class="block mb-1 text-gray-700 font-medium text-sm">Order placed by:</label>
                    <input type="text" id="orderBy" class="w-48 p-2 border rounded focus:ring-2 focus:ring-blue-300 text-sm" placeholder="Enter your name">
                    <div id="orderByError" class="text-red-600 text-sm hidden">Order placed by is required</div>
                </div>
                <button type="submit" id="createEmail" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-300 text-lg font-semibold">Create Email</button>
            </div>
        </form>
    </div>
    <script>
        // Fetch items from external JSON file
        fetch('items.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load items.json');
                }
                return response.json();
            })
            .then(items => {
                const itemList = document.getElementById('itemList');

                // Create a row for each item
                items.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = `item p-1 flex items-center space-x-4 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`;
                    div.dataset.itemName = item.name;
                    div.innerHTML = `
                        <div class="w-72 text-right">
                            <label class="text-sm text-gray-700">${item.name}</label>
                        </div>
                        <input type="number" class="quantity w-32 p-1 border rounded focus:ring-2 focus:ring-blue-300 text-sm" min="0" step="1">
                        <div class="w-40 text-left">
                            <span class="text-xs text-gray-500">${item.subtext}</span>
                        </div>
                    `;
                    itemList.appendChild(div);
                });
            })
            .catch(error => {
                console.error('Error loading items:', error);
                const itemList = document.getElementById('itemList');
                itemList.innerHTML = '<p class="text-red-600 text-center">Error loading items. Please try again later.</p>';
            });

        // Form submission
        document.getElementById('orderForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const items = document.querySelectorAll('.item');
            const orderBy = document.getElementById('orderBy');
            const orderByError = document.getElementById('orderByError');
            const notes = document.getElementById('notes');

            // Validate Order placed by field
            if (!orderBy.value.trim()) {
                orderByError.classList.remove('hidden');
                return;
            } else {
                orderByError.classList.add('hidden');
            }

            let emailBody = "\n"; // Start with a blank line
            emailBody += `Order placed by: ${orderBy.value.trim()}\n`;

            let hasQuantities = false;
            items.forEach(item => {
                const itemName = item.dataset.itemName;
                const quantityInput = item.querySelector('.quantity');
                const quantity = quantityInput ? Number(quantityInput.value) : 0;
                if (quantity > 0) {
                    emailBody += `${itemName}\t${quantity}\n`;
                    hasQuantities = true;
                }
            });

            if (!hasQuantities) {
                emailBody += `No quantities entered for reorder\n`;
            }

            if (notes.value.trim()) {
                emailBody += `\nOther Notes: ${notes.value.trim()}`;
            }

            const subject = `Shop Supplies Order - ${new Date().toLocaleDateString()}`;
            const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;
            window.location.href = mailtoLink;
        });
    </script>
</body>
</html>
